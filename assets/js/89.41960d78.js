(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{336:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"跨域通信的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域通信的方式"}},[t._v("#")]),t._v(" 跨域通信的方式")]),t._v(" "),a("ul",[a("li",[t._v("JSONP")]),t._v(" "),a("li",[t._v("CORS")]),t._v(" "),a("li",[t._v("Hash")]),t._v(" "),a("li",[t._v("postMessage")]),t._v(" "),a("li",[t._v("WebSoket")])]),t._v(" "),a("h3",{attrs:{id:"同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),a("ul",[a("li",[t._v("端口相同")]),t._v(" "),a("li",[t._v("域名相同")]),t._v(" "),a("li",[t._v("协议相同")])]),t._v(" "),a("p",[t._v("例子："),a("code",[t._v("http://www.example.com/dir/page.html")]),t._v(" 这个网址，协议是"),a("code",[t._v("http")]),t._v("，域名是"),a("code",[t._v("www.example.com")]),t._v("，端口是"),a("code",[t._v("80")])]),t._v(" "),a("p",[t._v("同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。"),a("strong",[t._v("是浏览器做的努力")])]),t._v(" "),a("h3",{attrs:{id:"同源策略限制范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略限制范围"}},[t._v("#")]),t._v(" 同源策略限制范围")]),t._v(" "),a("ul",[a("li",[t._v("Cookie、LocalStorage 和 IndexDB 无法读取")]),t._v(" "),a("li",[t._v("DOM 无法获得")]),t._v(" "),a("li",[t._v("AJAX 请求不能发送")])]),t._v(" "),a("h3",{attrs:{id:"cros跨域资源请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cros跨域资源请求"}},[t._v("#")]),t._v(" CROS跨域资源请求")]),t._v(" "),a("p",[t._v("CORS(Cross-origin resource sharing)跨域资源请求")]),t._v(" "),a("p",[t._v("浏览器在请求一个跨域资源的时候，如果是跨域的Ajax请求，他会在请求头中加一个"),a("code",[t._v("origin")]),t._v("字段，但他是不知道这个资源服务端是否允许跨域请求的。浏览器会发送到服务端，如果服务器返回的头中没有"),a("code",[t._v("'Access-Control-Allow-Origin': '对应网址或 * '")]),t._v(" 的话，那么浏览器就会把请求内容给忽略掉，并且在控制台报错")]),t._v(" "),a("h3",{attrs:{id:"cors限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors限制"}},[t._v("#")]),t._v(" CORS限制")]),t._v(" "),a("p",[t._v("允许的请求方法")]),t._v(" "),a("ul",[a("li",[t._v("GET")]),t._v(" "),a("li",[t._v("POST")]),t._v(" "),a("li",[t._v("HEAD")])]),t._v(" "),a("p",[t._v("允许的Content-Type")]),t._v(" "),a("ul",[a("li",[t._v("text/plain")]),t._v(" "),a("li",[t._v("multipart/form-data")]),t._v(" "),a("li",[t._v("application/x-www-form-ulencoded")])]),t._v(" "),a("p",[t._v("其他类型的请求方法和Content-Type需要通过"),a("strong",[t._v("预请求验证")]),t._v("后然后才能发送")]),t._v(" "),a("h3",{attrs:{id:"cors预请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors预请求"}},[t._v("#")]),t._v(" CORS预请求")]),t._v(" "),a("p",[t._v("跨域资源共享标准新增了一组 HTTP 首部字段，允许服务器声明哪些源站有权限访问哪些资源。另外，规范要求，对那些可能对服务器数据产生副作用的 HTTP 请求方法（特别是 GET 以外的 HTTP 请求，或者搭配某些 MIME 类型的 POST 请求），浏览器必须首先使用 OPTIONS 方法发起一个预检请求。")]),t._v(" "),a("p",[t._v("服务器在HTTP header中加入允许请求的方法和Content-Type后，其他指定的方法和Content-Type就可以成功请求了")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("'Access-Control-Allow-Headers': '允许Content-Type'\n'Access-Control-Allow-Methods': '允许的请求方法'\n'Access-Control-Max-Age': '预请求允许其他方法和类型传输的时间'\n")])])]),a("h3",{attrs:{id:"jsonp跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp跨域"}},[t._v("#")]),t._v(" JSONP跨域")]),t._v(" "),a("p",[t._v("浏览器上虽然有同源限制，但是像 srcipt标签、link标签、img标签、iframe标签，这种"),a("strong",[t._v("在标签上通过src地址来加载一些内容的时候浏览器是允许进行跨域请求的")]),t._v("。")]),t._v(" "),a("p",[t._v("所以JSONP的原理就是：")]),t._v(" "),a("ul",[a("li",[t._v("创建一个script标签，这个script标签的src就是请求的地址；")]),t._v(" "),a("li",[t._v("这个script标签插入到DOM中，浏览器就根据src地址访问服务器资源")]),t._v(" "),a("li",[t._v("返回的资源是一个文本，但是因为是在script标签中，浏览器会执行它")]),t._v(" "),a("li",[t._v("而这个文本恰好是函数调用的形式，即函数名（数据），浏览器会把它当作JS代码来执行即调用这个函数")]),t._v(" "),a("li",[t._v("只要提前约定好这个函数名，并且这个函数存在于window对象中，就可以把数据传递给处理函数。")])]),t._v(" "),a("h3",{attrs:{id:"hash值跨域通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash值跨域通信"}},[t._v("#")]),t._v(" Hash值跨域通信")]),t._v(" "),a("p",[t._v("背景：在页面A下提供iframe或frame嵌入了跨域的页面B")]),t._v(" "),a("p",[t._v("容器页面 -> 嵌入页通信：")]),t._v(" "),a("p",[t._v("在A页面中改变B的url中的hash值，B不会刷新，但是B可以用过"),a("code",[t._v("window.onhashchange")]),t._v("事件监听到hash变化")]),t._v(" "),a("h3",{attrs:{id:"postmessage通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postmessage通信"}},[t._v("#")]),t._v(" postMessage通信")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 窗口A中")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://A.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 窗口B中")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// http://A.com")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A 对象window引用")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"websoket-跨域通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#websoket-跨域通信"}},[t._v("#")]),t._v(" WebSoket 跨域通信")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ws "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wss://echo.websoket.org'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这个是后端端口")]),t._v("\n\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'some message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("evt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'连接关闭'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"document-domain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document-domain"}},[t._v("#")]),t._v(" document.domain")]),t._v(" "),a("p",[t._v("该方式只能用于二级域名相同的情况下，比如 a.test.com 和 b.test.com 适用于该方式。")]),t._v(" "),a("p",[t._v("只需要给页面添加 document.domain = 'test.com' 表示二级域名都相同就可以实现跨域")])])}),[],!1,null,null,null);s.default=e.exports}}]);